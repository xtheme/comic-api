<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

class RefactorUserTable extends Migration
{
    /**
     * Run the migrations.
     *
     * @return void
     */
    public function up()
    {
        Schema::table('users_clone', function (Blueprint $table) {
            $table->dropIndex('openid');
            $table->dropIndex('gzopenid');
            $table->dropIndex('payopenid');
            $table->dropIndex('tgid');
            $table->dropIndex('did');
            $table->dropIndex('sxid');

            $columns = [
                'name',
                'nickname',
                'password',
                'email',
                'email_bind',
                'avatar',
                'money',
                'role',
                'group',
                // 'signup_ip',
                'sort',
                'openid',
                'did',
                'isvip',
                'vipstime',
                'vipetime',
                'fcbl',
                'xingming',
                'fangshi',
                'zhanghao',
                'tgid',
                'guanzhu',
                'ewm',
                'isguanzhu',
                'sxid',
                'isout',
                'gzopenid',
                'agentlogin',
                'payopenid',
                'zjgz',
                'idnumber',
                'qq_id',
                'qq_uid',
                'weibo_id',
                'weixin_uid',
                'weixin_id',
                'auto_buy',
                'user_type',
                'tzurl',
                'device_tokens',
                'cover_img',
                'invite_uid',
                'invite_install_code',
                'version_type',
            ];

            $table->dropColumn($columns);

            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     *
     * @return void
     */
    public function down()
    {
        Schema::table('users_clone', function (Blueprint $table) {
            $table->string('name', 50)->nullable()->after('id')->comment('app用户昵称');
            $table->string('nickname', 50)->default('')->after('username')->comment('微信昵称');
            $table->string('password', 96)->default('')->after('nickname')->comment('密码');
            $table->string('email', 64)->default('')->after('password')->comment('邮箱地址');
            $table->tinyInteger('email_bind')->default(0)->after('email')->comment('是否绑定邮箱地址');
            $table->string('avatar', 255)->default('')->after('userface')->comment('微信头像');
            $table->decimal('money', 11, 2)->unsigned()->default('0.00')->after('avatar')->comment('余额');
            $table->integer('role')->unsigned()->nullable()->after('sign')->comment('角色ID：1超级管理员2代理商3普通用户4渠道商');
            $table->integer('group')->unsigned()->nullable()->after('role')->comment('部门id');
            // $table->string('signup_ip', 255)->default('')->after('group')->comment('注册ip');
            $table->integer('sort')->nullable()->default('100')->after('last_login_ip')->comment('排序');
            $table->string('openid', 100)->nullable()->default('')->after('status')->comment('openid');
            $table->integer('did')->nullable()->after('openid')->comment('推广代理ID');
            $table->integer('isvip')->nullable()->default('1')->after('did')->comment('VIP：1普通，2包月，3季度，4半年，5包年');
            $table->string('vipstime', 50)->nullable()->after('isvip')->comment('vip开始时间');
            $table->string('vipetime', 50)->nullable()->after('vipstime')->comment('vip结束时间');
            $table->string('fcbl', 20)->nullable()->after('vipetime')->comment('分成比例');
            $table->string('xingming', 100)->nullable()->after('fcbl')->comment('姓名');
            $table->string('fangshi', 150)->nullable()->after('xingming')->comment('结算方式');
            $table->string('zhanghao', 50)->nullable()->after('fangshi')->comment('结算账号');
            $table->integer('tgid')->nullable()->after('zhanghao')->comment('推广链接ID');
            $table->integer('guanzhu')->nullable()->after('sex')->comment('强制关注章节');
            $table->string('ewm', 100)->nullable()->after('guanzhu')->comment('推广二维码');
            $table->integer('isguanzhu')->nullable()->default('0')->after('ewm')->comment('是否关注0未关注1关注');
            $table->integer('sxid')->nullable()->after('isguanzhu')->comment('上线ID,只普通用户用,记录谁推广进来的');
            $table->smallInteger('isout', 100)->nullable()->after('sxid')->comment('是否超福利期');
            $table->string('gzopenid', 100)->nullable()->after('isout')->comment('关注公众号的openid');
            $table->integer('agentlogin')->nullable()->after('gzopenid')->comment('是否用代理登陆的用户');
            $table->string('payopenid', 50)->nullable()->after('agentlogin')->comment('支付用的openid如果是代理登陆的话使用');
            $table->integer('zjgz')->nullable()->after('payopenid')->comment('最近一次关注的公众号id');
            $table->integer('idnumber')->nullable()->default('0')->after('zjgz')->comment('idnumber');
            $table->string('qq_id', 100)->nullable()->default('')->after('idnumber')->comment('QQ openid');
            $table->string('qq_uid', 100)->nullable()->default('')->after('qq_id')->comment('QQ unionid');
            $table->string('weibo_id', 100)->nullable()->default('')->after('qq_uid')->comment('微博openid');
            $table->string('weixin_uid', 100)->nullable()->default('')->after('weibo_id')->comment('微信用户unionid');
            $table->string('weixin_id', 100)->nullable()->default('')->after('weixin_uid')->comment('微信app openid');
            $table->tinyInteger('auto_buy')->nullable()->default('0')->after('token')->comment('用户是否自动购买章节');
            $table->tinyInteger('user_type')->nullable()->default('0')->after('auto_buy')->comment('0：app注册用户，1：游客');
            $table->string('tzurl', 100)->nullable()->after('device_id')->comment('关注跳转');
            $table->string('device_tokens', 100)->nullable()->default('')->after('tzurl')->comment('设备token');
            $table->string('cover_img', 255)->nullable()->default('')->after('device_tokens')->comment('主页封面图');
            $table->string('invite_uid', 80)->nullable()->default('0')->after('cover_img')->comment('邀请发起人用户码');
            $table->string('invite_install_code', 80)->nullable()->default('0')->after('invite_uid')->comment('openinstall邀请安装码');
            $table->tinyInteger('version_type', 255)->default('1')->after('total_comment')->comment('版本 1安卓，2ios');

            $table->index('openid', 'openid');
            $table->index('gzopenid', 'gzopenid');
            $table->index('payopenid', 'payopenid');
            $table->index('tgid', 'tgid');
            $table->index('did', 'did');
            $table->index('sxid', 'sxid');

            $table->dropTimestamps();
        });
    }
}
